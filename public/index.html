<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:image" content="https://path2rebirth-map.pages.dev/images/penguin1.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="600" />
  <title>メニュー | 再生の道 進捗マップ</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container-sm my-5">
    <div class="col-lg-12 px-0">
      <nav class="mb-4 d-flex align-items-start">
        <a href="about.html" class="btn btn-outline-secondary me-2">当サイトについて</a>
      </nav>
      
      <div id="penguin-image" style="text-align: center; margin-bottom: 1rem; display: none;">
        <img src="https://path2rebirth-map.pages.dev/images/penguin1.png" alt="ペンギン" style="height: 100px; width: auto;">
      </div>

      <ul class="nav nav-tabs mb-4" id="progressMapTabs" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="flyer-tab" data-bs-toggle="tab" data-bs-target="#flyer-section"
    type="button" role="tab" aria-controls="flyer-section" aria-selected="true">
      ビラ配布
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="volunteer-tab" data-bs-toggle="tab" data-bs-target="#volunteer-section"
    type="button" role="tab" aria-controls="volunteer-section" aria-selected="false">
    ボランティア
  </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="poster-tab" data-bs-toggle="tab" data-bs-target="#poster-section"
    type="button" role="tab" aria-controls="poster-section" aria-selected="false">
    ポスター
  </button>
  </li>
</ul>

      
      
      <div class="tab-content" id="progressMapTabsContent">
        <!-- ボランティア募集内容（デフォルトで表示） -->
        <div class="tab-pane fade" id="volunteer-section" role="tabpanel" aria-labelledby="volunteer-tab">
          <p>ボランティアを募集中です。下記の外部サイトよりご登録できます。</p>
          <div class="tab-pane fade show active" id="volunteer-section" role="tabpanel" aria-labelledby="volunteer-tab">
            <h4 class="mb-3">東京選挙区（吉田さん）</h4>
            <p>国分寺、国立、品川、小金井市は陣営本部から。昭島は松尾さんのDMから。</p>
            <div class="row row-cols-1 row-cols-md-2 g-3 mb-4">
              <div class="col">
                <a href="https://docs.google.com/forms/d/e/1FAIpQLScLKciWeRATgk53cAR7cWoofdQiij-ZMOF9GyivfabxXu4OfA/viewform" class="text-decoration-none">
                  <div class="card shadow-sm h-100 border-primary">
                    <div class="card-body text-center">
                      <h5 class="card-title mb-0">チーム江戸川</h5>
                    </div>
                  </div>
                </a>
              </div>

              <div class="col">
                <a href="https://docs.google.com/forms/d/e/1FAIpQLSfV4gkQsSFAKwOXwN1i35e0QyUMZw8P_hsVj02eBny2KfTaWQ/viewform" class="text-decoration-none">
                  <div class="card shadow-sm h-100 border-primary">
                    <div class="card-body text-center">
                      <h5 class="card-title mb-0">チーム新宿</h5>
                    </div>
                  </div>
                </a>
              </div>
            
              <div class="col">
                <a href="https://t.co/s8IS2wL56w" class="text-decoration-none">
                  <div class="card shadow-sm h-100 border-primary">
                    <div class="card-body text-center">
                      <h5 class="card-title mb-0">チーム中野</h5>
                    </div>
                  </div>
                </a>
              </div>

              <div class="col">
                  <a href="https://docs.google.com/forms/d/e/1FAIpQLSe4cE6EPkSp3UH6YkpeMTIDxTp4ZM2qzCHl7CNpcuy4MRaoEg/viewform" class="text-decoration-none">
                    <div class="card shadow-sm h-100 border-primary">
                      <div class="card-body text-center">
                        <h5 class="card-title mb-0">チーム板橋/北/練馬</h5>
                      </div>
                    </div>
                  </a>
              </div>

              <div class="col">
                  <a href="https://t.co/4Sf1ilLNxP" class="text-decoration-none">
                    <div class="card shadow-sm h-100 border-primary">
                      <div class="card-body text-center">
                        <h5 class="card-title mb-0">チーム武蔵野</h5>
                      </div>
                    </div>
                  </a>
              </div>

              <div class="col">
                  <a href="https://t.co/qjAzwDMEr9" class="text-decoration-none">
                    <div class="card shadow-sm h-100 border-primary">
                      <div class="card-body text-center">
                        <h5 class="card-title mb-0">チーム大田</h5>
                      </div>
                    </div>
                  </a>
              </div>



              <div class="col">
                  <a href="https://t.co/1rV9p6XONF" class="text-decoration-none">
                    <div class="card shadow-sm h-100 border-primary">
                      <div class="card-body text-center">
                        <h5 class="card-title mb-0">陣営本部 (ポスター貼り 7/3木)</h5>
                      </div>
                    </div>
                  </a>
              </div>

              <div class="col">
                  <a href="https://t.co/whGhsfbeG7" class="text-decoration-none">
                    <div class="card shadow-sm h-100 border-primary">
                      <div class="card-body text-center">
                        <h5 class="card-title mb-0">陣営本部 (街頭演説補助)</h5>
                      </div>
                    </div>
                  </a>
              </div>


            </div>
          
            <h4 class="mb-3">全国比例区</h4>
            <div class="row row-cols-1 row-cols-md-2 g-3">
              <div class="col">
                <a href="https://docs.google.com/forms/d/e/1FAIpQLSfCKRek4XHPoXzehC3vJyaiG3oRA21Rte0bEQEvPoT2kN5Yyw/viewform" class="text-decoration-none">
                  <div class="card shadow-sm h-100 border-success">
                    <div class="card-body text-center">
                      <h5 class="card-title mb-0">小林さん</h5>
                    </div>
                  </div>
                </a>
              </div>
              <div class="col">
                <a href="https://t.co/H81d52cpVC" class="text-decoration-none">
                  <div class="card shadow-sm h-100 border-success">
                    <div class="card-body text-center">
                      <h5 class="card-title mb-0">横山さん</h5>
                    </div>
                  </div>
                </a>
              </div>
              <div class="col">
                <a href="https://t.co/XGPUe5DAfU" class="text-decoration-none">
                  <div class="card shadow-sm h-100 border-success">
                    <div class="card-body text-center">
                      <h5 class="card-title mb-0">浦野さん</h5>
                    </div>
                  </div>
                </a>
              </div>

              <div class="col">
                <a href="https://line.me/ti/g2/sXQ_93ozN65ZtJMhBuQWQ3rXWoVv9yWpE60qEQ?utm_source=invitation&utm_medium=link_copy&utm_campaign=default" class="text-decoration-none">
                  <div class="card shadow-sm h-100 border-success">
                    <div class="card-body text-center">
                      <h5 class="card-title mb-0">木島さん</h5>
                    </div>
                  </div>
                </a>
              </div>

            </div>
          </div>
        </div>
        <!-- ポスター掲示進捗マップ -->
        <div class="tab-pane fade" id="poster-section" role="tabpanel" aria-labelledby="poster-tab">
          <h3 class="mb-4">参院選2025 ポスター掲示進捗マップ</h3>
          <div id="poster-candidate-list" class="row row-cols-2 g-3 mb-4">
            <!-- ポスター候補者ボタン -->
          </div>
        </div>
      
        <!-- ビラ配布進捗マップ -->
        <div class="tab-pane fade show active" id="flyer-section" role="tabpanel" aria-labelledby="flyer-tab">
          <h3 class="mb-4">参議院議員選挙 2025</h3>
          <p style="text-align: center;">
            近日中に運用開始予定です<br>
            登録がお済みの方は、各県のページから配布報告できます。<br>
            登録がお済みでない方は <a href="https://forms.gle/zaCGpxD3v2oA34LY6" target="_blank">こちらをクリック</a>
          </p>
        <div class="accordion" id="flyerAccordion">
          <!-- 各地方のアコーディオンをJSで生成 -->
        </div>
        </div>
      </div>
      

      
    </div>
  </div>
  
  <script>
    // 表示対象とする区のリスト（今後ここを編集するだけでOK）
    const targetDistricts = ["中央区", "八王子市"];
  
async function poster_loadCandidates() {
  const response = await fetch('data/candidates_all.json');
  const candidates = await response.json();
  const list = document.getElementById('poster-candidate-list');

  // 重複防止用セット
  const displayedSet = new Set();

  candidates.forEach(candidate => {
    const district = candidate.district;
    const name = candidate.name;
    const lastName = name.split(' ')[0];
    const isGroup = candidate.group === "True";

    // 以下のif文で表示する選挙区ボタンを制限
    if (!targetDistricts.includes(district)) return;

    // 重複防止キーの作り方変更
    const key = isGroup
      ? `${district}_group`
      : `${district}_${name}`;

    // すでに表示済みならスキップ
    if (displayedSet.has(key)) return;
    displayedSet.add(key);

    // UI 作成
    const col = document.createElement('div');
    col.className = 'col';

    const card = document.createElement('div');
    card.className = 'border rounded p-3 h-100 d-flex align-items-center justify-content-center bg-light shadow-sm text-center';
    card.style.cursor = 'pointer';
    card.textContent = `${district}`;
    
    //都議専用
    //card.textContent = `${district}: ${isGroup ? '全体' : lastName}`;


    card.onclick = () => {
      const url = isGroup
        ? `map/poster_map.html?district=${district}&name=グループ`
        : `map/poster_map.html?district=${district}&name=${lastName}`;

      window.location.href = url;
    };

    col.appendChild(card);
    list.appendChild(col);
  });
}

async function flyer_loadPrefectures() {
  const [prefResponse, progressResponse] = await Promise.all([
    fetch('data/prefecture.json'),
    fetch('data/flyer_progress_allCity.json')
  ]);

  const regionMap = {
  "北海道・東北地方": ["北海道", "青森県", "岩手県", "宮城県", "秋田県", "山形県", "福島県"],
  "関東地方": ["茨城県", "栃木県", "群馬県", "埼玉県", "千葉県", "東京都", "神奈川県"],
  "中部地方": ["新潟県", "富山県", "石川県", "福井県", "山梨県", "長野県", "岐阜県", "静岡県", "愛知県"],
  "近畿地方": ["三重県", "滋賀県", "京都府", "大阪府", "兵庫県", "奈良県", "和歌山県"],
  "中国地方": ["鳥取県", "島根県", "岡山県", "広島県", "山口県"],
  "四国地方": ["徳島県", "香川県", "愛媛県", "高知県"],
  "九州・沖縄地方": ["福岡県", "佐賀県", "長崎県", "熊本県", "大分県", "宮崎県", "鹿児島県", "沖縄県"]
};


  const prefectures = await prefResponse.json();
  const progressData = await progressResponse.json();

  const list = document.getElementById("flyerAccordion");

for (const [regionName, prefList] of Object.entries(regionMap)) {
  const accordionId = `region-${regionName.replace(/[^\u3040-\u30FF\u4E00-\u9FFF\w]/g, '')}`;


  // アコーディオン構造作成
  const item = document.createElement('div');
  item.className = 'accordion-item';
  item.innerHTML = `
    <h2 class="accordion-header" id="heading-${accordionId}">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-${accordionId}">
        ${regionName}
      </button>
    </h2>
    <div id="collapse-${accordionId}" class="accordion-collapse collapse">
      <div class="accordion-body">
        <div class="row row-cols-2 row-cols-md-3 g-3" id="area-${accordionId}"></div>
      </div>
    </div>`;
  list.appendChild(item);

  // 都道府県カード追加（prefListの中から一致するデータを探して）
  prefList.forEach(pref => {
    const prefData = Object.values(prefectures).find(p => p.prefecture === pref);
    if (!prefData) return;

    const area = document.getElementById(`area-${accordionId}`);
    const col = document.createElement('div');
    col.className = 'col';

    const card = document.createElement('div');
    card.className = 'card shadow-sm h-100 border-primary';
    card.style.cursor = 'pointer';

    const cardBody = document.createElement('div');
    cardBody.className = 'card-body';

    const title = document.createElement('h5');
    title.className = 'card-title text-center mb-0';
    title.textContent = `${prefData.id}. ${prefData.prefecture}`;
    cardBody.appendChild(title);

    // ▼▼▼ 進捗を flyer_progress.json から取得 ▼▼▼
    const progressEntry = progressData[prefData.prefecture]?.["全市区町村"];
    const progress = progressEntry?.["flyer_progress"]*100 || 0;
    //console.log(`${prefData.prefecture}`)

    // 進捗バー
    const progressWrapper = document.createElement('div');
    progressWrapper.className = 'position-relative w-100 mt-3 rounded';
    progressWrapper.style.height = '8px';
    progressWrapper.style.backgroundColor = '#eee';
    progressWrapper.style.overflow = 'hidden';

    const layers = getProgressBarLayers(progress);
    layers.forEach(layer => {
      const bar = document.createElement('div');
      bar.style.position = 'absolute';
      bar.style.left = 0;
      bar.style.top = 0;
      bar.style.height = '100%';
      bar.style.width = layer.width;
      bar.style.backgroundColor = layer.color;
      progressWrapper.appendChild(bar);
    });

    cardBody.appendChild(progressWrapper);
    card.appendChild(cardBody);
    col.appendChild(card);
    area.appendChild(col);

    card.onclick = () => {
      const url = `map/flyer_map.html?prefecture=${encodeURIComponent(prefData.prefecture)}`;
      window.location.href = url;
    };
  });
}

}

// 進捗バーの4段階分割処理
function getProgressBarLayers(progress) {
  const stages = [0.1, 1, 10, 100];
  const baseColor = { r: 112, g: 21, b: 112 };
  const alphas = [0.17, 0.34, 0.51, 1.0]; // 段階ごとの透明度

  const layers = [];
  let previousMax = 0;

  for (let i = 0; i < stages.length; i++) {
    const min = previousMax;
    const max = stages[i];
    const range = max - min;

    const alpha = alphas[i]; // ← 指定した透明度を使う
    const color = `rgba(${baseColor.r}, ${baseColor.g}, ${baseColor.b}, ${alpha})`;

    let widthPercent = 0;

    if (progress >= max) {
      widthPercent = 100;
    } else if (progress > min) {
      widthPercent = ((progress - min) / range) * 100;
    } else {
      widthPercent = 0;
    }

    layers.push({
      width: `${widthPercent}%`,
      color,
    });

    previousMax = max;
  }

  return layers;
}

    // ビラ配布用
    poster_loadCandidates();
    // ビラ配布用のボタン読み込み
    flyer_loadPrefectures();
      
  </script>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
